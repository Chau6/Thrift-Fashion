/*================================================================================
 * @name: bPopup - if you can't get it up, use bPopup
 * @author: (c)Bjoern Klinggaard (twitter@bklinggaard)
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.11.0.min
 ================================================================================*/
!function(o){o.fn.bPopup=function(t,e){function n(){h.modal&&o('<div class="b-modal '+b+'"></div>').css({backgroundColor:h.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:h.zIndex+W}).appendTo(h.appendTo).fadeTo(h.speed,h.opacity),p(),U.data("bPopup",h).data("id",b).css({left:"slideIn"==h.transition||"slideBack"==h.transition?"slideBack"==h.transition?I.scrollLeft()+B:-1*(T+x):c(!(!h.follow[0]&&g||C)),position:h.positionStyle||"absolute",top:"slideDown"==h.transition||"slideUp"==h.transition?"slideUp"==h.transition?I.scrollTop()+z:k+-1*y:r(!(!h.follow[1]&&m||C)),"z-index":h.zIndex+W+1}).each(function(){h.appending&&o(this).appendTo(h.appendTo)}),s(!0)}function i(){return h.modal&&o(".b-modal."+U.data("id")).fadeTo(h.speed,0,function(){o(this).remove()}),h.scrollBar||o("html").css("overflow","auto"),o(".b-modal."+b).unbind("click"),I.unbind("keydown."+b),S.unbind("."+b).data("bPopup",0<S.data("bPopup")-1?S.data("bPopup")-1:null),U.undelegate(".bClose, ."+h.closeClass,"click."+b,i).data("bPopup",null),clearTimeout(P),s(),!1}function a(t){z=S.height(),B=S.width(),((w=f()).x||w.y)&&(clearTimeout(v),v=setTimeout(function(){p(),t=t||h.followSpeed;var e={};w.x&&(e.left=h.follow[0]?c(!0):"auto"),w.y&&(e.top=h.follow[1]?r(!0):"auto"),U.dequeue().each(function(){C?o(this).css({left:T,top:k}):o(this).animate(e,t,h.followEasing)})},50))}function l(o){var t=o.width(),e=o.height(),n={};h.contentContainer.css({height:e,width:t}),e>=U.height()&&(n.height=U.height()),t>=U.width()&&(n.width=U.width()),y=U.outerHeight(!0),x=U.outerWidth(!0),p(),h.contentContainer.css({height:"auto",width:"auto"}),n.left=c(!(!h.follow[0]&&g||C)),n.top=r(!(!h.follow[1]&&m||C)),U.animate(n,250,function(){o.show(),w=f()})}function s(o){function t(t){U.css({display:"block",opacity:1}).animate(t,h.speed,h.easing,function(){d(o)})}switch(o?h.transition:h.transitionClose||h.transition){case"slideIn":t({left:o?c(!(!h.follow[0]&&g||C)):I.scrollLeft()-(x||U.outerWidth(!0))-200});break;case"slideBack":t({left:o?c(!(!h.follow[0]&&g||C)):I.scrollLeft()+B+200});break;case"slideDown":t({top:o?r(!(!h.follow[1]&&m||C)):I.scrollTop()-(y||U.outerHeight(!0))-200});break;case"slideUp":t({top:o?r(!(!h.follow[1]&&m||C)):I.scrollTop()+z+200});break;default:U.stop().fadeTo(h.speed,o?1:0,function(){d(o)})}}function d(t){t?(S.data("bPopup",W),U.delegate(".bClose, ."+h.closeClass,"click."+b,i),h.modalClose&&o(".b-modal."+b).css("cursor","pointer").bind("click",i),H||!h.follow[0]&&!h.follow[1]||S.bind("scroll."+b,function(){if(w.x||w.y){var o={};w.x&&(o.left=h.follow[0]?c(!C):"auto"),w.y&&(o.top=h.follow[1]?r(!C):"auto"),U.dequeue().animate(o,h.followSpeed,h.followEasing)}}).bind("resize."+b,function(){a()}),h.escClose&&I.bind("keydown."+b,function(o){27==o.which&&i()}),u(e),h.autoClose&&(P=setTimeout(i,h.autoClose))):(U.hide(),u(h.onClose),h.loadUrl&&(h.contentContainer.empty(),U.css({height:"auto",width:"auto"})))}function c(o){return o?T+I.scrollLeft():T}function r(o){return o?k+I.scrollTop():k}function u(t,e){o.isFunction(t)&&t.call(U,e)}function p(){k=m?h.position[1]:Math.max(0,(z-U.outerHeight(!0))/2-h.amsl),T=g?h.position[0]:(B-U.outerWidth(!0))/2,w=f()}function f(){return{x:B>U.outerWidth(!0),y:z>U.outerHeight(!0)}}o.isFunction(t)&&(e=t,t=null);var h=o.extend({},o.fn.bPopup.defaults,t);h.scrollBar||o("html").css("overflow","hidden");var b,w,m,g,C,k,T,y,x,v,P,U=this,I=o(document),S=o(window),z=S.height(),B=S.width(),H=/OS 6(_\d)+/i.test(navigator.userAgent),W=0;return U.close=function(){i()},U.reposition=function(o){a(o)},U.each(function(){o(this).data("bPopup")||(u(h.onOpen),W=(S.data("bPopup")||0)+1,b="__b-popup"+W+"__",m="auto"!==h.position[1],g="auto"!==h.position[0],C="fixed"===h.positionStyle,y=U.outerHeight(!0),x=U.outerWidth(!0),h.loadUrl?function(){switch(h.contentContainer=o(h.contentContainer||U),h.content){case"iframe":var t=o('<iframe class="b-iframe" '+h.iframeAttr+"></iframe>");t.appendTo(h.contentContainer),y=U.outerHeight(!0),x=U.outerWidth(!0),n(),t.attr("src",h.loadUrl),u(h.loadCallback);break;case"image":n(),o("<img />").load(function(){u(h.loadCallback),l(o(this))}).attr("src",h.loadUrl).hide().appendTo(h.contentContainer);break;default:n(),o('<div class="b-ajax-wrapper"></div>').load(h.loadUrl,h.loadData,function(t,e,n){u(h.loadCallback,e),l(o(this))}).hide().appendTo(h.contentContainer)}}():n())})},o.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}}(jQuery)